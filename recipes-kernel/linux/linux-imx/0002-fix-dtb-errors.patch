From b85c8bfcbb030f2ff44dc771eff44e33e94ac010 Mon Sep 17 00:00:00 2001
From: Marina Calvo <mcalvo@rbz.es>
Date: Tue, 21 Dec 2021 12:32:13 +0000
Subject: [PATCH 2/2] fix-dtb-errors

Signed-off-by: Marina Calvo <mcalvo@rbz.es>
---
 arch/arm64/boot/dts/rbz/imx8mp.dtsi        |  2 +-
 arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts | 55 +++++-----------------
 2 files changed, 12 insertions(+), 45 deletions(-)

diff --git a/arch/arm64/boot/dts/rbz/imx8mp.dtsi b/arch/arm64/boot/dts/rbz/imx8mp.dtsi
index 50fa108127ed..e3ce91956f9e 100644
--- a/arch/arm64/boot/dts/rbz/imx8mp.dtsi
+++ b/arch/arm64/boot/dts/rbz/imx8mp.dtsi
@@ -10,7 +10,7 @@
 #include <dt-bindings/interrupt-controller/arm-gic.h>
 #include <dt-bindings/thermal/thermal.h>
 
-#include "imx8mp-pinfunc.h"
+#include "../freescale/imx8mp-pinfunc.h"
 
 / {
 	interrupt-parent = <&gic>;
diff --git a/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts b/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts
index debf27bc00f3..4691bebe7e86 100644
--- a/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts
+++ b/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts
@@ -61,33 +61,6 @@
         reset-post-delay-ms = <40>;
         #reset-cells = <0>;
     };
-
-	sound-hdmi {
-		compatible = "fsl,imx-audio-cdnhdmi";
-		model = "audio-hdmi";
-		audio-cpu = <&aud2htx>;
-		hdmi-out;
-		constraint-rate = <44100>,
-				<88200>,
-				<176400>,
-				<32000>,
-				<48000>,
-				<96000>,
-				<192000>;
-		status = "okay";
-	};
-
-	sound-micfil {
-		compatible = "fsl,imx-audio-micfil";
-		model = "imx-audio-micfil";
-		cpu-dai = <&micfil>;
-	};
-
-	sound-xcvr {
-		compatible = "fsl,imx-audio-xcvr";
-		model = "imx-audio-xcvr";
-		cpu-dai = <&xcvr>;
-	};
 };
 
 &A53_0 {
@@ -95,15 +68,15 @@
 };
 
 &A53_1 {
-	cpu-supply = <&buck2>;
+	cpu-supply = <&buck2_reg>;
 };
 
 &A53_2 {
-	cpu-supply = <&buck2>;
+	cpu-supply = <&buck2_reg>;
 };
 
 &A53_3 {
-	cpu-supply = <&buck2>;
+	cpu-supply = <&buck2_reg>;
 };
 
 &dsp {
@@ -126,7 +99,7 @@
 			compatible = "ethernet-phy-ieee802.3-c22";
 			reg = <0>;
             interrupt-parent = <&gpio1>;
-            interrupts = <9 8>; 
+            interrupts = <9 8>;
 			eee-broken-1000t;
 		};
 	};
@@ -284,8 +257,7 @@
 	};
 };
 
-&easrc {
-	fsl,asrc-rate  = <48000>;
+&snvs_pwrkey {
 	status = "okay";
 };
 
@@ -294,12 +266,12 @@
 	pinctrl-0 = <&pinctrl_pcie>;
 	reset-gpio = <&gpio2 9 GPIO_ACTIVE_LOW>;
 	ext_osc = <1>;
-	clocks = <&clk IMX8MP_CLK_HSIO_AXI_DIV>,
+	clocks = <&clk IMX8MP_CLK_HSIO_ROOT>,
 		 <&clk IMX8MP_CLK_PCIE_AUX>,
-		 <&clk IMX8MP_CLK_DUMMY>,
+		 <&clk IMX8MP_CLK_HSIO_AXI>,
 		 <&clk IMX8MP_CLK_PCIE_ROOT>;
 	clock-names = "pcie", "pcie_aux", "pcie_phy", "pcie_bus";
-	assigned-clocks = <&clk IMX8MP_CLK_HSIO_AXI_SRC>,
+	assigned-clocks = <&clk IMX8MP_CLK_HSIO_AXI>,
 			  <&clk IMX8MP_CLK_PCIE_AUX>;
 	assigned-clock-rates = <500000000>, <10000000>;
 	assigned-clock-parents = <&clk IMX8MP_SYS_PLL2_500M>,
@@ -312,12 +284,12 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_pcie>;
 	ext_osc = <1>;
-	clocks = <&clk IMX8MP_CLK_HSIO_AXI_DIV>,
+	clocks = <&clk IMX8MP_CLK_HSIO_ROOT>,
 		 <&clk IMX8MP_CLK_PCIE_AUX>,
-		 <&clk IMX8MP_CLK_DUMMY>,
+		 <&clk IMX8MP_CLK_HSIO_AXI>,
 		 <&clk IMX8MP_CLK_PCIE_ROOT>;
 	clock-names = "pcie", "pcie_aux", "pcie_phy", "pcie_bus";
-	assigned-clocks = <&clk IMX8MP_CLK_HSIO_AXI_SRC>,
+	assigned-clocks = <&clk IMX8MP_CLK_HSIO_AXI>,
 			  <&clk IMX8MP_CLK_PCIE_AUX>;
 	assigned-clock-rates = <500000000>, <10000000>;
 	assigned-clock-parents = <&clk IMX8MP_SYS_PLL2_500M>,
@@ -330,11 +302,6 @@
 	status = "okay";
 };
 
-&xcvr {
-	#sound-dai-cells = <0>;
-	status = "okay";
-};
-
 &sdma2 {
 	status = "okay";
 };
-- 
2.17.1

