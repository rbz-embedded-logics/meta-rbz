From 62458fe1d6daa9ab22cc9dcf4e8faeab1995f89c Mon Sep 17 00:00:00 2001
From: Marina Calvo <mcalvo@rbz.es>
Date: Wed, 12 Jan 2022 13:21:29 +0000
Subject: [PATCH 7/7] add-lvds-and-tpm-support

Signed-off-by: Marina Calvo <mcalvo@rbz.es>
---
 arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts  |   5 +
 arch/arm64/boot/dts/rbz/mod-imx8m-plus.dtsi | 112 +++++++++++++++++++-
 arch/arm64/configs/imx_v8_defconfig         |   7 +-
 3 files changed, 119 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts b/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts
index ea03aa53fd6f..fa8ee7f9f6f7 100644
--- a/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts
+++ b/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dts
@@ -270,6 +270,11 @@
 			};
 		};
 	};
+
+    tpm: tpm@29 {
+        compatible = "atmel,at97sc3204t";
+        reg = <0x29>;
+    };
 };
 
 &snvs_pwrkey {
diff --git a/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dtsi b/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dtsi
index 14333dcbed92..20eb5c92d10f 100644
--- a/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dtsi
+++ b/arch/arm64/boot/dts/rbz/mod-imx8m-plus.dtsi
@@ -19,7 +19,67 @@
 		reg = <0x0 0x40000000 0 0xc0000000>,
 		      <0x1 0x00000000 0 0xc0000000>;
 	};
-
+  
+    lvds0_panel: lvds0_panel@0 {
+        compatible = "panel-lvds";
+        width-mm = <216>;
+        height-mm = <135>;
+        data-mapping = "jeida-18";
+        status = "okay";
+
+        port {
+            panel_lvds0_in: endpoint {
+                remote-endpoint = <&lvds0_out>;
+            };
+        };
+
+        panel-timing { 
+            clock-frequency = <25175000>;
+            hactive = <640>;
+            vactive = <480>;
+            hfront-porch = <24>;
+            hback-porch = <40>;
+            hsync-len = <96>;
+            vback-porch = <32>;
+            vfront-porch = <11>;
+            vsync-len = <2>;
+            hsync-active = <0>;
+            vsync-active = <0>;
+            de-active = <1>;
+            pixelclk-active = <0>;
+        };
+    };
+  
+/*    lvds1_panel: lvds1_panel@1 {
+        compatible = "panel-lvds";
+        data-mapping = "jeida-18";
+        width-mm = <216>;
+        height-mm = <135>;
+        status = "okay";
+
+        port {
+            panel_lvds1_in: endpoint {
+                remote-endpoint = <&lvds1_out>;
+            };
+        };
+
+        panel-timing { 
+            clock-frequency = <25000000>;
+            hactive = <640>;
+            vactive = <480>;
+            hfront-porch = <1>;
+            hback-porch = <7>;
+            hsync-len = <60>;
+            vback-porch = <20>;
+            vfront-porch = <20>;
+            vsync-len = <10>;
+            hsync-active = <0>;
+            vsync-active = <0>;
+            de-active = <0>;
+            pixelclk-active = <0>;
+        };
+    };
+*/
 	reg_usb1_host_vbus: regulator-usb1-vbus {
 		compatible = "regulator-fixed";
 		regulator-name = "usb1_host_vbus";
@@ -283,6 +343,52 @@
 			};
 		};
 	};
+
+    tpm: tpm@29 {
+        compatible = "atmel,at97sc3204t";
+        reg = <0x29>;
+    };
+};
+
+&lcdif2 {
+	status = "okay";
+};
+
+&ldb {
+    status = "okay";
+
+    lvds-channel@1 {
+        fsl,data-mapping = "spwg";
+        fsl,data-width = <18>;
+        status = "okay";
+            
+        port@1 {
+            reg = <1>;
+
+            lvds0_out: endpoint {
+                remote-endpoint = <&panel_lvds0_in>;
+            };
+        };
+    };
+
+/*    lvds-channel@1 {
+        fsl,data-mapping = "spwg";
+        fsl,data-width = <18>;
+        status = "okay";
+  
+        port@1 {
+            reg = <1>;
+  
+            lvds1_out: endpoint {
+                remote-endpoint = <&panel_lvds1_in>;
+            };
+        };
+    };
+*/
+};
+
+&ldb_phy {
+	status = "okay";
 };
 
 &snvs_pwrkey {
@@ -589,8 +695,8 @@
         fsl,pins = <
             MX8MP_IOMUXC_UART4_RXD__UART4_DCE_RX        0x140
             MX8MP_IOMUXC_UART4_TXD__UART4_DCE_TX        0x140
-            MX8MP_IOMUXC_ECSPI2_MISO__UART4_DCE_CTS     0x140
-            MX8MP_IOMUXC_ECSPI2_SS0__UART4_DCE_RTS      0x140
+    /*        MX8MP_IOMUXC_ECSPI2_MISO__UART4_DCE_CTS     0x140
+            MX8MP_IOMUXC_ECSPI2_SS0__UART4_DCE_RTS      0x140*/
         >;
     };   
 
diff --git a/arch/arm64/configs/imx_v8_defconfig b/arch/arm64/configs/imx_v8_defconfig
index efa0c762c304..4f6a92193315 100644
--- a/arch/arm64/configs/imx_v8_defconfig
+++ b/arch/arm64/configs/imx_v8_defconfig
@@ -379,8 +379,11 @@ CONFIG_VIRTIO_CONSOLE=y
 CONFIG_IPMI_HANDLER=m
 CONFIG_IPMI_DEVICE_INTERFACE=m
 CONFIG_IPMI_SI=m
-CONFIG_TCG_TPM=y
-CONFIG_TCG_TIS_I2C_INFINEON=y
+CONFIG_TCG_TPM=m
+CONFIG_TCG_TIS_I2C_ATMEL=m
+CONFIG_TCG_TIS_I2C_INFINEON=m
+CONFIG_TCG_TIS_I2C_NUVOTON=m
+CONFIG_TCG_ATMEL=m
 CONFIG_I2C_CHARDEV=y
 CONFIG_I2C_MUX=y
 CONFIG_I2C_MUX_PCA954x=y
-- 
2.17.1

